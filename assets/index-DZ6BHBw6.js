(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"9a93c610-4c06-4e72-81fb-e79d7b8ec97d","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),Y=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(u),O=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(u),Z=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(u),ee=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(u),te=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(u),oe=({userCard:e})=>fetch(`${a.baseUrl}/cards/${e._id}`,{method:"DELETE",headers:a.headers}).then(u),re=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(o=>u(o)),N=e=>{e.classList.toggle("card__like-button_is-active")},ne=e=>{e.remove()},ce=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),W=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoCard:r})=>{const c=ce(),s=c.querySelector(".card__like-button"),L=c.querySelector(".card__control-button_type_delete"),_=c.querySelector(".card__image"),m=c.querySelector(".card__control-button_type_info");return _.src=e.link,_.alt=e.name,c.querySelector(".card__title").textContent=e.name,o&&s.addEventListener("click",()=>o(s)),n&&L.addEventListener("click",()=>n(c)),t&&_.addEventListener("click",()=>t({name:e.name,link:e.link})),r&&m.addEventListener("click",()=>r(e._id)),c},H=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");i(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",H)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",H)},ae=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})};function se(e,t,o,n){const r=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),t.dataset.errorMessage?r.textContent=t.dataset.errorMessage:r.textContent=n,r.classList.add(o.errorClass)}function j(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function ie(e,t,o){t.validity.valid?j(e,t,o):(se(e,t,o,t.validationMessage),V(e,t,o))}function le(e){return e.some(t=>!t.validity.valid)}function J(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function ue(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}function V(e,t,o){le(e)?J(t,o):ue(t,o)}function pe(e,t){const o=e.querySelector(t.submitButtonSelector),n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach(r=>{r.addEventListener("input",()=>{ie(e,r,t),V(n,o,t)})})}function q(e,t){const o=e.querySelector(t.submitButtonSelector);Array.from(e.querySelectorAll(t.inputSelector)).forEach(r=>{j(e,r,t)}),J(o,t)}function de(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{pe(o,e)})}const R=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),S=k.querySelector(".popup__form"),z=S.querySelector(".popup__input_type_name"),K=S.querySelector(".popup__input_type_description"),E=document.querySelector(".popup_type_new-card"),l=E.querySelector(".popup__form"),_e=l.querySelector(".popup__input_type_card-name"),me=l.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),T=I.querySelector(".popup__image"),fe=I.querySelector(".popup__caption"),ye=document.querySelector(".profile__edit-button"),he=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),w=document.querySelector(".popup_type_remove-card"),G=w.querySelector(".popup__form"),F=document.querySelector(".popup_type_edit-avatar"),h=F.querySelector(".popup__form"),Se=h.querySelector(".popup__input"),M=document.querySelector(".popup_type_info"),f=M.querySelector(".popup__info"),U=M.querySelector(".popup__list"),ve=document.getElementById("popup-info-definition-template"),Le=document.getElementById("popup-info-user-preview-template"),v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Q=({name:e,link:t})=>{T.src=t,T.alt=e,fe.textContent=e,d(I)},A=S.querySelector(".popup__button"),D=l.querySelector(".popup__button"),$=h.querySelector(".popup__button"),p=G.querySelector(".popup__button");let y={cardData:null,currentCardElement:null};const C=(e,t)=>{e.dataset.originalText=e.textContent,e.textContent=`${t}...`},g=e=>{e.textContent=e.dataset.originalText},be=e=>{e.preventDefault(),C(A,"Сохранение"),Z({name:z.value,about:K.value}).then(t=>{B.textContent=t.name,x.textContent=t.about,i(k)}).catch(t=>{console.log(t)}).finally(()=>{g(A)})},qe=e=>{e.preventDefault(),C($,"Сохранение"),ee(Se.value).then(t=>{P.style.backgroundImage=`url(${t.avatar})`,i(F)}).catch(t=>{console.log(t)}).finally(()=>{g($)})},Ce=e=>{e.preventDefault(),C(D,"Создание"),te({name:_e.value,link:me.value}).then(t=>{R.prepend(W({name:t.name,link:t.link},{onPreviewPicture:Q,onLikeIcon:N,onDeleteCard:ne,onInfoCard:X})),i(E)}).catch(t=>{console.log(t)}).finally(()=>{g(D)}),q(l,v)};S.addEventListener("submit",be);l.addEventListener("submit",Ce);h.addEventListener("submit",qe);ye.addEventListener("click",()=>{z.value=B.textContent,K.value=x.textContent,d(k),q(S,v)});P.addEventListener("click",()=>{h.reset(),d(F),q(h,v)});he.addEventListener("click",()=>{l.reset(),d(E),q(l,v)});const ge=document.querySelectorAll(".popup");ge.forEach(e=>{ae(e)});de(v);const ke=(e,t,o)=>{e.owner._id!==t._id&&(o.style.display="none")},Ee=(e,t,o)=>{e.likes.forEach(n=>{n._id===t._id&&o.classList.add("card__like-button_is-active")})},Ie=e=>e.classList.contains("card__like-button_is-active"),Be=(e,t)=>{y.cardData=e,y.currentCardElement=t,p.classList.remove("popup__button_disabled"),p.disabled=!1,d(w)},xe=e=>{e.preventDefault(),C(p,"Удаление"),oe({userCard:y.cardData}).then(()=>{y.currentCardElement.remove(),p.classList.add("popup__button_disabled"),p.disabled=!0,i(w),y={cardData:null,currentCardElement:null}}).catch(t=>{console.log("ошибка при удалении:",t)}).finally(()=>{g(p)})};G.addEventListener("submit",xe);Promise.all([O(),Y()]).then(([e,t])=>{e.forEach(o=>{const n=W(o,{onPreviewPicture:Q,onLikeIcon:()=>{const L=n.querySelector(".card__like-button"),_=n.querySelector(".card__like-count");re(o._id,Ie(L)).then(m=>{N(L),_.textContent=m.likes.length}).catch(m=>{console.log("ошибка при лайке:",m)})},onDeleteCard:()=>{Be(o,n)},onInfoCard:()=>{X(o._id)}}),r=n.querySelector(".card__like-button");Ee(o,t,r),R.append(n);const c=n.querySelector(".card__control-button_type_delete");ke(o,t,c);const s=n.querySelector(".card__like-count");s.textContent=o.likes.length}),B.textContent=t.name,x.textContent=t.about,P.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});const Pe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),b=(e,t)=>{const o=ve.content.querySelector(".popup__info-item").cloneNode(!0),n=o.querySelector(".popup__info-term"),r=o.querySelector(".popup__info-description");return n.textContent=e,r.textContent=t,o},we=e=>{const t=Le.content.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e,t},X=e=>{f.innerHTML="",U.innerHTML="",O().then(t=>{let o=t.find(n=>n._id===e);f.append(b("Описание:",o.name)),f.append(b("Дата создания:",Pe(new Date(o.createdAt)))),f.append(b("Владелец:",o.owner.name)),f.append(b("Количество лайков:",o.likes.length)),o.likes.forEach(n=>{U.append(we(n.name))}),d(M)}).catch(t=>{console.log(t)})};
