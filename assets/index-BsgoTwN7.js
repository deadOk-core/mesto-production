(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"9a93c610-4c06-4e72-81fb-e79d7b8ec97d","Content-Type":"application/json"}},l=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),K=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(l),$=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(l),G=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(l),Q=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(l),X=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(l),Y=({userCard:e})=>fetch(`${s.baseUrl}/cards/${e._id}`,{method:"DELETE",headers:s.headers}).then(l),Z=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(o=>l(o)),A=e=>{e.classList.toggle("card__like-button_is-active")},ee=e=>{e.remove()},te=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:r,onInfoCard:n})=>{const c=te(),i=c.querySelector(".card__like-button"),u=c.querySelector(".card__control-button_type_delete"),d=c.querySelector(".card__image"),_=c.querySelector(".card__control-button_type_info");return d.src=e.link,d.alt=e.name,c.querySelector(".card__title").textContent=e.name,o&&i.addEventListener("click",()=>o(i)),r&&u.addEventListener("click",()=>r(c)),t&&d.addEventListener("click",()=>t({name:e.name,link:e.link})),n&&_.addEventListener("click",()=>n(e._id)),c},D=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",D)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",D)},oe=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})};function ne(e,t,o,r){const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),t.dataset.errorMessage?n.textContent=t.dataset.errorMessage:n.textContent=r,n.classList.add(o.errorClass)}function N(e,t,o){const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""}function re(e,t,o){t.validity.valid?N(e,t,o):(ne(e,t,o,t.validationMessage),H(e,t,o))}function ce(e){return e.some(t=>!t.validity.valid)}function W(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function se(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}function H(e,t,o){ce(e)?W(t,o):se(t,o)}function ie(e,t){const o=e.querySelector(t.submitButtonSelector),r=Array.from(e.querySelectorAll(t.inputSelector));r.forEach(n=>{n.addEventListener("input",()=>{re(e,n,t),H(r,o,t)})})}function L(e,t){const o=e.querySelector(t.submitButtonSelector);Array.from(e.querySelectorAll(t.inputSelector)).forEach(n=>{N(e,n,t)}),W(o,t)}function ae(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{ie(o,e)})}const j=document.querySelector(".places__list"),q=document.querySelector(".popup_type_edit"),h=q.querySelector(".popup__form"),J=h.querySelector(".popup__input_type_name"),V=h.querySelector(".popup__input_type_description"),b=document.querySelector(".popup_type_new-card"),a=b.querySelector(".popup__form"),le=a.querySelector(".popup__input_type_card-name"),ue=a.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),w=C.querySelector(".popup__image"),pe=C.querySelector(".popup__caption"),de=document.querySelector(".profile__edit-button"),_e=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_edit-avatar"),m=E.querySelector(".popup__form"),fe=m.querySelector(".popup__input"),B=document.querySelector(".popup_type_info"),f=B.querySelector(".popup__info"),T=B.querySelector(".popup__list"),me=document.getElementById("popup-info-definition-template"),ye=document.getElementById("popup-info-user-preview-template"),S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},R=({name:e,link:t})=>{w.src=t,w.alt=e,pe.textContent=e,y(C)},U=h.querySelector(".popup__button"),F=a.querySelector(".popup__button"),M=m.querySelector(".popup__button"),x=(e,t)=>{e.dataset.originalText=e.textContent,e.textContent=`${t}...`},P=e=>{e.textContent=e.dataset.originalText},he=e=>{e.preventDefault(),x(U,"Сохранение"),G({name:J.value,about:V.value}).then(t=>{g.textContent=t.name,k.textContent=t.about,p(q)}).catch(t=>{console.log(t)}).finally(()=>{P(U)})},Se=e=>{e.preventDefault(),x(M,"Сохранение"),Q(fe.value).then(t=>{I.style.backgroundImage=`url(${t.avatar})`,p(E)}).catch(t=>{console.log(t)}).finally(()=>{P(M)})},ve=e=>{e.preventDefault(),x(F,"Создание"),X({name:le.value,link:ue.value}).then(t=>{j.prepend(O({name:t.name,link:t.link},{onPreviewPicture:R,onLikeIcon:A,onDeleteCard:ee,onInfoCard:z})),p(b)}).catch(t=>{console.log(t)}).finally(()=>{P(F)}),L(a,S)};h.addEventListener("submit",he);a.addEventListener("submit",ve);m.addEventListener("submit",Se);de.addEventListener("click",()=>{J.value=g.textContent,V.value=k.textContent,y(q),L(h,S)});I.addEventListener("click",()=>{m.reset(),y(E),L(m,S)});_e.addEventListener("click",()=>{a.reset(),y(b),L(a,S)});const Le=document.querySelectorAll(".popup");Le.forEach(e=>{oe(e)});ae(S);const qe=(e,t,o)=>{e.owner._id!==t._id&&(o.style.display="none")},be=(e,t,o)=>{e.likes.forEach(r=>{r._id===t._id&&o.classList.add("card__like-button_is-active")})},Ce=e=>e.classList.contains("card__like-button_is-active");Promise.all([$(),K()]).then(([e,t])=>{e.forEach(o=>{const r=O(o,{onPreviewPicture:R,onLikeIcon:()=>{const u=r.querySelector(".card__like-button"),d=r.querySelector(".card__like-count");Z(o._id,Ce(u)).then(_=>{A(u),d.textContent=_.likes.length}).catch(_=>{console.log("ошибка при лайке:",_)})},onDeleteCard:()=>{Y({userCard:o}).then(()=>{r.remove()}).catch(u=>{console.log("ошибка при удалении:",u)})},onInfoCard:()=>{z(o._id)}}),n=r.querySelector(".card__like-button");be(o,t,n),j.append(r);const c=r.querySelector(".card__control-button_type_delete");qe(o,t,c);const i=r.querySelector(".card__like-count");i.textContent=o.likes.length}),g.textContent=t.name,k.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});const ge=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),v=(e,t)=>{const o=me.content.querySelector(".popup__info-item").cloneNode(!0),r=o.querySelector(".popup__info-term"),n=o.querySelector(".popup__info-description");return r.textContent=e,n.textContent=t,o},ke=e=>{const t=ye.content.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e,t},z=e=>{f.innerHTML="",T.innerHTML="",$().then(t=>{let o=t.find(r=>r._id===e);f.append(v("Описание:",o.name)),f.append(v("Дата создания:",ge(new Date(o.createdAt)))),f.append(v("Владелец:",o.owner.name)),f.append(v("Количество лайков:",o.likes.length)),o.likes.forEach(r=>{T.append(ke(r.name))}),y(B)}).catch(t=>{console.log(t)})};
